<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>修改用户信息</title>
	<link href="layui/css/layui.css" rel="stylesheet">
</head>

<body>
	<div class="page-content-wrap" id="userAdd">

		<form class="layui-form" action="" id="">

			<div class="layui-form-item">
				<label class="layui-form-label">用户ID</label>
				<div class="layui-input-block">
					<input type="text" name="userId" readonly="readonly" style="background:#CCCCCC" id="userId" lay-verify="userId"
						autocomplete="off" placeholder="请输入用户ID" class="layui-input">
				</div>
			</div>

			<div class="layui-form-item">
				<label class="layui-form-label">用户名</label>
				<div class="layui-input-block">
					<input type="text" name="userName"  id="userName" lay-verify="userName"
						placeholder="请输入用户姓名" autocomplete="off" class="layui-input">
				</div>
			</div>

			<div class="layui-form-item">
				<label class="layui-form-label">年龄</label>
				<div class="layui-input-block">
					<input type="text" name="age"  id="age" lay-verify="age"
						   placeholder="请输入用户年龄" autocomplete="off" class="layui-input">
				</div>
			</div>

			<div class="layui-form-item">
				<label class="layui-form-label">性别</label>
				<div class="layui-input-block">
					<select name="userSex" lay-verify="required"  class="userSex">
						<option value="">请选择用户性别</option>
						<option value="男">男</option>
						<option value="女">女</option>
					</select>
				</div>
			</div>

			<div class="layui-form-item m-login-btn" style="text-align:center">
				<div class="layui-inline">
					<button class="layui-btn layui-btn-normal" lay-submit lay-filter="editUser">修改信息</button>
				</div>
				<div class="layui-inline">
					<button type="reset" class="layui-btn layui-btn-primary  site-demo-active"
					data-type="resetEdit">取消修改</button>
				</div>
			</div>
		</form>

		<hr></hr>
		<h5 style="text-align: center;">@2023.用户管理系统</h5>
	</div>

	<script src="layui/layui.js"></script>

	<script>
	layui.use(function(){
		var form = layui.form;
		var layer = layui.layer;
		var $ = layui.jquery;

		//自定义验证规则
		form.verify({
			userName: [
			  /^[\S]{2,10}$/
			  ,'用户姓名必须2到12位，且不能出现空格'
			],
			age: [
				/^[\d]{1,10}$/,
				'请输入数字'
			]
		});

		form.on('submit(editUser)', function(data){
			var str=JSON.stringify(data.field)
			console.log(data.field);
			var param = JSON.parse(str);
			//console.log(param.userId);
			$.ajax({
				type: "POST",//方法类型
				dataType: "json",//预期服务器返回的数据类型
				url: "/v1/updateUserInfo",//url
				data: {
					id:param.userId,
					userName:param.userName,
					age:param.age,
					sex:param.userSex
				},
				success: function (result) {
					if (result.code == "0") {
						var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
						parent.layer.close(index); // 关闭当前 iframe 弹层
						parent.layer.msg('编辑用户成功',{icon: 1});
						parent.layui.table.reload('idTest',{
							page:{curr:1}
						});
					} else {
						layer.msg('编辑用户失败', {
							icon: 5,
							anim: 6
						});
					}
				},
				error : function() {
					layer.msg('服务器错误', {
						icon: 5,
						anim: 6
					});
				}
			});
			return false;
		});

		//触发事件方法定义
		var active = {
		resetEdit : function() {
			var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
			parent.layer.close(index);
			parent.layer.msg('已取消操作');
		}
		};
		//触发事件方法调用
		$('#userAdd .layui-btn').on('click', function() {
			var type = $(this).data('type');
			console.log(type);
			active[type] ? active[type].call(this) : '';
		});

	});
	</script>
</body>

</html>